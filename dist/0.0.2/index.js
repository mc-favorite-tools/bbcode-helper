// ==UserScript==
// @name            bbcode-helper
// @namespace       http://hans0000.github.io/
// @version         0.0.2
// @author          hans000
// @description     该项目用于扩展mcbbs论坛富文本编辑器，使其能编辑表格行列等，并提供获取页面bbcode的能力
// @run-at          document-end
// @match           https://www.mcbbs.net/*
// @grant           none
// @icon            data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==
// @require         https://unpkg.com/react@18.2.0/umd/react.production.min.js
// @require         https://unpkg.com/state-local@1.0.7/lib/umd/state-local.min.js
// @require         https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js
// @require         https://unpkg.com/prop-types@15.8.1/prop-types.min.js
// ==/UserScript==

(function(){"use strict";try{if(typeof document!="undefined"){var o=document.createElement("style");o.appendChild(document.createTextNode('.hs-toolbar{z-index:1;position:fixed;top:0;left:0}.hs-toolbar div,.hs-toolbar span{box-sizing:border-box}.hs-toolbar .col-cursor{position:fixed;width:0;border:1px solid #009eff}.hs-toolbar .col-cursor:before{content:"+";cursor:pointer;display:block;width:16px;line-height:16px;color:#fff;text-align:center;height:16px;margin:-8px 0 0 -8px;border-radius:50%;background-color:#009eff}.hs-toolbar .row-cursor{position:fixed;height:0;border:1px solid #009eff}.hs-toolbar .row-cursor:before{content:"+";cursor:pointer;display:block;width:16px;line-height:16px;color:#fff;text-align:center;height:16px;margin:-8px 0 0 -8px;border-radius:50%;background-color:#009eff}.hs-toolbar .lt-tile{position:relative;width:10px;height:10px;background-color:#ececec;margin-left:-10px;margin-top:-10px;cursor:pointer}.hs-toolbar .lt-tile:hover:after{content:"x";display:block;background-color:red;text-align:center;line-height:10px}.hs-toolbar>.row{position:relative;flex-direction:column;display:flex;width:10px;background-color:#ececec;margin-left:-10px}.hs-toolbar>.row .row-item{position:relative;flex:auto;cursor:pointer;display:flex;align-items:center;box-shadow:0 0 1px #aaa}.hs-toolbar>.row .row-item:hover{background-color:#cdcdcd}.hs-toolbar>.row .row-item:hover:after{content:"";display:inline-block;width:10px;height:16px;background:linear-gradient(to right,transparent 0,transparent 3px,#747474 3px,#747474 4px,transparent 4px,transparent 5px,#747474 5px,#747474 6px,transparent 6px,transparent 7px,#747474 7px,#747474 8px,transparent 8px,transparent 9px)}.hs-toolbar>.col-resize{position:relative;width:0;height:0;margin-top:-10px;height:10px}.hs-toolbar>.col-resize .col-resize-item{position:absolute;display:block;width:2px;cursor:col-resize;user-select:none}.hs-toolbar>.col-resize .col-resize-item:hover{background-color:#009eff}.hs-toolbar>.col-all{position:absolute;cursor:pointer;width:100%;height:10px;background-color:#ececec;margin-top:-20px;text-align:center}.hs-toolbar>.col-all:hover{background-color:#cdcdcd}.hs-toolbar>.col-all:hover:after{content:"";display:inline-block;width:16px;height:10px;background:linear-gradient(to bottom,transparent 0,transparent 3px,#747474 3px,#747474 4px,transparent 4px,transparent 5px,#747474 5px,#747474 6px,transparent 6px,transparent 7px,#747474 7px,#747474 8px,transparent 8px,transparent 9px)}.hs-toolbar>.col{position:relative;display:flex;height:10px;background-color:#ececec;margin-top:-10px}.hs-toolbar>.col .col-item{position:relative;flex:auto;cursor:pointer;text-align:center;box-shadow:0 0 1px #aaa}.hs-toolbar>.col .col-item:hover{background-color:#cdcdcd}.hs-toolbar>.col .col-item:hover:after{content:"";display:inline-block;width:16px;height:10px;background:linear-gradient(to bottom,transparent 0,transparent 3px,#747474 3px,#747474 4px,transparent 4px,transparent 5px,#747474 5px,#747474 6px,transparent 6px,transparent 7px,#747474 7px,#747474 8px,transparent 8px,transparent 9px)}.hs-toolbar .row-btn-group{z-index:1;position:absolute;transform:translate(-100%)}.hs-toolbar .row-btn-group>div{width:14px;height:14px;line-height:14px;text-align:center;cursor:pointer;color:#fff;font-size:13px;background-color:#009eff;margin-bottom:2px}.hs-toolbar .row-btn-group .btn-delete{background-color:red;margin-right:2px}.hs-toolbar .col-btn-group{z-index:1;position:absolute;display:flex;justify-content:right;padding:5px 0;right:0;top:-20px;width:100%;min-width:48px}.hs-toolbar .col-btn-group>div{width:14px;height:14px;line-height:14px;text-align:center;cursor:pointer;color:#fff;font-size:13px;background-color:#009eff;margin-left:2px}.hs-toolbar .col-btn-group .btn-delete{background-color:red;margin-right:2px}.color-picker-wrapper{padding:20px;box-sizing:content-box;background-color:#fff;box-shadow:0 3px 6px -4px #0000001f,0 6px 16px #00000014,0 9px 28px 8px #0000000d}.color-picker-basic-color{display:flex;flex-wrap:wrap;gap:10px;margin:16px 0;padding:0}.color-picker-basic-color button{border:1px solid #ccc;border-radius:4px;height:16px;width:16px;cursor:pointer;list-style-type:none}.color-picker-basic-color button.active{box-shadow:0 0 2px 2px #0000004d}.color-picker-saturation{width:100%;position:relative;height:150px;background-image:linear-gradient(transparent,black),linear-gradient(to right,white,transparent);user-select:none}.color-picker-saturation_cursor{position:absolute;width:20px;height:20px;border:2px solid #ffffff;border-radius:50%;box-shadow:0 0 15px #00000026;box-sizing:border-box;transform:translate(-10px,-10px)}.color-picker-hue{width:100%;position:relative;margin-top:15px;height:12px;background-image:linear-gradient(to right,rgb(255,0,0),rgb(255,255,0),rgb(0,255,0),rgb(0,255,255),rgb(0,0,255),rgb(255,0,255),rgb(255,0,0));user-select:none;border-radius:12px}.color-picker-hue_cursor{position:absolute;width:20px;height:20px;border:2px solid #ffffff;border-radius:50%;box-shadow:#0003 0 0 0 .5px;box-sizing:border-box;transform:translate(-10px,-4px)}.color-picker-color{border:1px solid #ccc;margin-top:15px;width:100%;height:20px}')),document.head.appendChild(o)}}catch(r){console.error("vite-plugin-css-injected-by-js",r)}})();
var Ie=Object.defineProperty,qe=Object.defineProperties;var Re=Object.getOwnPropertyDescriptors;var pe=Object.getOwnPropertySymbols;var $e=Object.prototype.hasOwnProperty,je=Object.prototype.propertyIsEnumerable;var be=(c,x,F)=>x in c?Ie(c,x,{enumerable:!0,configurable:!0,writable:!0,value:F}):c[x]=F,ee=(c,x)=>{for(var F in x||(x={}))$e.call(x,F)&&be(c,F,x[F]);if(pe)for(var F of pe(x))je.call(x,F)&&be(c,F,x[F]);return c},te=(c,x)=>qe(c,Re(x));(function(c,x){"use strict";const F=t=>t&&typeof t=="object"&&"default"in t?t:{default:t},X=F(c),ne=F(x);var V={},oe=ne.default;V.createRoot=oe.createRoot,V.hydrateRoot=oe.hydrateRoot;const He="";function H(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function re(...t){return()=>t.forEach(e=>e())}function ge(t,e){let n=t;for(;n.parentElement;)if(n=n.parentElement,n.tagName.toLowerCase()===e)return n;return null}function ve(t){const e=document.createElement("script");return e.setAttribute("type","text/javascript"),e.setAttribute("src",t),document.documentElement.appendChild(e),new Promise(n=>e.addEventListener("load",()=>{e.remove(),n(void 0)}))}const Oe="";var G={exports:{}},Y={};/**
* @license React
* react-jsx-runtime.production.min.js
*
* Copyright (c) Facebook, Inc. and its affiliates.
*
* This source code is licensed under the MIT license found in the
* LICENSE file in the root directory of this source tree.
*/var Ee=X.default,ye=Symbol.for("react.element"),we=Symbol.for("react.fragment"),Ce=Object.prototype.hasOwnProperty,xe=Ee.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ke={key:!0,ref:!0,__self:!0,__source:!0};function ce(t,e,n){var o,l={},a=null,y=null;n!==void 0&&(a=""+n),e.key!==void 0&&(a=""+e.key),e.ref!==void 0&&(y=e.ref);for(o in e)Ce.call(e,o)&&!ke.hasOwnProperty(o)&&(l[o]=e[o]);if(t&&t.defaultProps)for(o in e=t.defaultProps,e)l[o]===void 0&&(l[o]=e[o]);return{$$typeof:ye,type:t,key:a,ref:y,props:l,_owner:xe.current}}Y.Fragment=we,Y.jsx=ce,Y.jsxs=ce,function(t){t.exports=Y}(G);const s=G.exports.jsx,I=G.exports.jsxs;function De(t){const[e,n]=c.useState(!1),o=c.useRef(null),l=c.useRef(null);return c.useEffect(()=>{const a=document.createElement("div");l.current=a;const{top:y,left:d,height:w}=o.current.getBoundingClientRect();return a.style.cssText=`
            z-index: 999;
            position: fixed;
            top: ${y+w}px;
            left: ${d}px;
        `,document.body.appendChild(a),()=>{document.body.removeChild(a)}},[]),I("div",{style:t.style,className:t.className,children:[s("span",{ref:o,onMouseEnter:()=>n(!0),children:t.children}),e&&ne.default.createPortal(s("span",{children:t.overlay}),l.current)]})}const le=[{name:"\u9ED1\u8272",id:"black",sc:"#000000",fc:"#000000",bc:"#000000"},{name:"\u6DF1\u84DD\u8272",id:"dark_blue",sc:"#0000b2",fc:"#0000aa",bc:"#00002a"},{name:"\u6DF1\u7EFF\u8272",id:"dark_green",sc:"#14ab00",fc:"#00aa00",bc:"#002a00"},{name:"\u6E56\u84DD\u8272",id:"dark_aqua",sc:"#13aaab",fc:"#00aaaa",bc:"#002a2a"},{name:"\u6DF1\u7EA2\u8272",id:"dark_red",sc:"#a90400",fc:"#aa0000",bc:"#2a0000"},{name:"\u7D2B\u8272",id:"dark_purple",sc:"#a900b2",fc:"#aa00aa",bc:"#2a002a"},{name:"\u91D1\u8272",id:"gold",sc:"#feac00",fc:"#ffaa00",bc:"#2a2a00"},{name:"\u7070\u8272",id:"gray",sc:"#aaaaaa",fc:"#aaaaaa",bc:"#2a2a2a"},{name:"\u6DF1\u7070\u8272",id:"dark_gray",sc:"#555555",fc:"#555555",bc:"#151515"},{name:"\u84DD\u8272",id:"blue",sc:"#544cff",fc:"#5555ff",bc:"#15153f"},{name:"\u7EFF\u8272",id:"green",sc:"#5cff00",fc:"#55ff55",bc:"#153f15"},{name:"\u5929\u84DD\u8272",id:"aqua",sc:"#5bffff",fc:"#55ffff",bc:"#153f3f"},{name:"\u7EA2\u8272",id:"red",sc:"#fd5650",fc:"#ff5555",bc:"#3f1515"},{name:"\u7C89\u7EA2\u8272",id:"light_purple",sc:"#fd4dff",fc:"#ff55ff",bc:"#3f153f"},{name:"\u9EC4\u8272",id:"yellow",sc:"#ffff00",fc:"#ffff55",bc:"#3f3f15"},{name:"\u767D\u8272",id:"white",sc:"#ffffff",fc:"#ffffff",bc:"#3f3f3f"}],Fe=le.map(t=>t.fc),O=214,se=150;function _e(t){const[e,n]=c.useState($(typeof t.defaultColor=="object"?"rgb":"hex",t.defaultColor||"")),[o,l]=c.useState(t.color),a=c.useRef(null),[y,d]=c.useState(!1),w=c.useMemo(()=>({x:e.hsv.s/100*O,y:(100-e.hsv.v)/100*se}),[e.hsv.s,e.hsv.v]),L=c.useMemo(()=>({x:e.hsv.h/360*O}),[e.hsv]),N=b=>{var _;const S=b.target.value;if(l(S),/^#[0-9A-Fa-f]{6}$/i.test(S)){const k=$("hex",S);n(k),(_=t.onChange)==null||_.call(t,k.hex)}},j=({x:b,y:S})=>{var P;const _=te(ee({},e.hsv),{s:b/O*100,v:100-S/se*100}),k=$("hsv",_);n(k),l(k.hex),(P=t.onChange)==null||P.call(t,k.hex)},W=({x:b})=>{var k;const S=te(ee({},e.hsv),{h:b/O*360}),_=$("hsv",S);n(_),l(_.hex),(k=t.onChange)==null||k.call(t,_.hex)};return c.useEffect(()=>{if(t.color===void 0)return;const b=$("hex",t.color);n(b),l(b.hex)},[t.color]),s(De,{className:"dropdown",onVisibleChange:b=>{d(b)},visible:y,overlay:I("div",{className:"color-picker-wrapper",style:{width:O},onClick:b=>{b.preventDefault()},ref:a,children:[s("input",{prefix:"Hex",onChange:N,value:o}),s("div",{className:"color-picker-basic-color",children:Fe.map((b,S)=>s("button",{title:le[S].id,className:b===e.hex?" active":"",style:{backgroundColor:b},onClick:()=>{var k;l(b);const _=$("hex",b);n(_),(k=t.onChange)==null||k.call(t,_.hex)}},b))}),s(ae,{className:"color-picker-saturation",style:{backgroundColor:`hsl(${e.hsv.h}, 100%, 50%)`},onChange:j,children:s("div",{className:"color-picker-saturation_cursor",style:{backgroundColor:e.hex,left:w.x,top:w.y}})}),s(ae,{className:"color-picker-hue",onChange:W,children:s("div",{className:"color-picker-hue_cursor",style:{backgroundColor:`hsl(${e.hsv.h}, 100%, 50%)`,left:L.x}})}),s("div",{className:"color-picker-color",style:{backgroundColor:e.hex}})]}),children:t.children})}function ae({className:t,style:e,onChange:n,children:o}){const l=c.useRef(null),a=d=>{if(l.current){const{current:w}=l,{width:L,height:N,left:j,top:W}=w.getBoundingClientRect(),B=ie(d.clientX-j,L,0),b=ie(d.clientY-W,N,0);n({x:B,y:b})}};return s("div",{ref:l,className:t,style:e,onMouseDown:d=>{if(d.button!==0)return;a(d);const w=N=>{a(N)},L=N=>{document.removeEventListener("mousemove",w,!1),document.removeEventListener("mouseup",L,!1),a(N)};document.addEventListener("mousemove",w,!1),document.addEventListener("mouseup",L,!1)},children:o})}function ie(t,e,n){return t>e?e:t<n?n:t}function ue(t){if(t.startsWith("#")){if(t.length===4||t.length===5)return t=t.split("").map((e,n)=>n?e+e:"#").join(""),t;if(t.length===7||t.length===9)return t}else{const e=document.createElement("canvas").getContext("2d");if(!e)throw new Error("2d context not supported or canvas already initialized");return e.fillStyle=t,e.fillStyle}return"#000000"}function de(t){const e=(t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(n,o,l,a)=>"#"+o+o+l+l+a+a).substring(1).match(/.{2}/g)||[]).map(n=>parseInt(n,16));return{b:e[2],g:e[1],r:e[0]}}function K({r:t,g:e,b:n}){t/=255,e/=255,n/=255;const o=Math.max(t,e,n),l=o-Math.min(t,e,n),a=l?(o===t?(e-n)/l+(e<n?6:0):o===e?2+(n-t)/l:4+(t-e)/l)*60:0,y=o?l/o*100:0,d=o*100;return{h:a,s:y,v:d}}function Ne({h:t,s:e,v:n}){e/=100,n/=100;const o=~~(t/60),l=t/60-o,a=n*(1-e),y=n*(1-e*l),d=n*(1-e*(1-l)),w=o%6,L=Math.round([n,y,a,a,d,n][w]*255),N=Math.round([d,n,n,y,a,a][w]*255);return{b:Math.round([a,a,d,n,n,y][w]*255),g:N,r:L}}function fe({b:t,g:e,r:n}){return"#"+[n,e,t].map(o=>o.toString(16).padStart(2,"0")).join("")}function $(t,e){let n=ue("#121212"),o=de(n),l=K(o);return t==="hex"?(n=ue(e),o=de(n),l=K(o)):t==="rgb"?(o=e,n=fe(o),l=K(o)):t==="hsv"&&(l=e,o=Ne(l),n=fe(o)),{hex:n,hsv:l,rgb:o}}const Be={height:0,width:0,x:0,y:0,bottom:0,left:0,right:0,top:0,toJSON:function(){}};function he(t){const e=html2bbcode(t.outerHTML);navigator.clipboard.writeText(e),showPrompt(null,null,"<span>\u6A21\u677F\u5DF2\u590D\u5236\u5230\u526A\u8D34\u677F</span>",1500)}function Se(){const[t,e]=c.useState(""),[n,o]=c.useState(null),[l,a]=c.useState(null),[,y]=c.useState(!1),d=c.useRef(null),[w,L]=c.useState(-1),[N,j]=c.useState(-1),[W,B]=c.useState(-1),[b,S]=c.useState(0),[_,k]=c.useState(0),P=c.useRef(Be),[Z,M]=c.useState(null),Ae=c.useRef(null),q=c.useRef(null),J=c.useRef(!1),[Le,Pe]=c.useState(!0);c.useEffect(()=>{const g=document.querySelector("#e_tip");if(g){const p=g.parentElement,f=document.createElement("a");f.innerText="\u542F\u7528/\u5173\u95ED | ",f.href="javascript:;",p.insertBefore(f,g),f.addEventListener("click",()=>Pe(v=>!v))}},[]),c.useEffect(()=>{const g=new MutationObserver(f=>{for(const v of f)if(v.type==="childList"){const T=document.querySelector("#e_tbl_param_1"),C=document.querySelector("#e_tbl_param_2"),A=document.querySelector("#e_tbl_param_3");T.value="1",C.value="1",A.value="100%"}}),p=document.querySelector("#e_menus");if(p)return g.observe(p,{childList:!0,subtree:!0}),()=>g.disconnect()},[]),c.useEffect(()=>re(H(window,"load",g=>{const p=document.getElementById("e_iframe");if(p){const f=p.contentWindow.document,v=f.head,T=f.createElement("style");T.innerText=`
                    body {
                        background-color: #fff;
                    }
                    table td {
                        border: 1px solid #E3EDF5;
                    }
                    .t_table:not([width]) {
                        width: 100%;
                    }
                    div.quote {
                        background: #F9F9F9 url(https://www.mcbbs.net/template/mcbbs/image/icon_quote_s.gif) no-repeat 20px 6px;
                    }
                    div.quote blockquote:last-child {
                        background: url(https://www.mcbbs.net/template/mcbbs/image/icon_quote_e.gif) no-repeat 100% 100%;
                    }
                    br[style] {
                        display: none;
                    }
                    blockquote {
                        display: inline-block;
                    }
                    tr.dragover {
                        border: 8px dashed #ffae00;
                    }
                    `,v.appendChild(T),f.addEventListener("click",C=>{const A=C.target;P.current=p.getBoundingClientRect(),d.current=ge(A,"table"),d.current?(e("table"),y(h=>!h),a(null),o(null)):(e(""),M(null),B(-1))}),f.addEventListener("scroll",()=>{e(""),M(null),B(-1)}),f.addEventListener("mouseover",C=>{Ae.current=C.target}),f.addEventListener("drop",C=>{C.preventDefault();const A=C.dataTransfer.getData("text/plain"),h=d.current;if(A==="table")C.target.appendChild(h);else if(A.startsWith("row")){const r=parseInt(A.match(/(\d+)$/)[1]),m=C.target,i=m.parentElement,u=i.parentElement;m.tagName==="TD"&&u.parentElement===d.current&&u.insertBefore(u.children.item(r),i)}else if(A.startsWith("col")){const r=parseInt(A.match(/(\d+)$/)[1]),m=C.target,i=m.parentElement,u=i.parentElement,E=Array.from(u.children),z=Array.from(i.children);if(m.tagName==="TD"&&u.parentElement===d.current){const D=z.findIndex(R=>R===m);E.forEach(R=>{const U=R.children;R.insertBefore(U.item(r),U.item(D+(r<D?1:0)))})}}e("")}),f.addEventListener("keydown",C=>{C.key==="Escape"&&e("")})}}),H(window,"scroll",()=>{e(""),M(null),B(-1)}),H(window,"keydown",g=>{g.key==="Escape"&&e("")})),[]),c.useEffect(()=>{const g=document.querySelector(".vwthd");g&&(window.allowhtml=!0,window.allowbbcode=!0,ve("https://static.mcbbs.net/data/cache/bbcode.js").then(()=>{const p=document.createElement("span");p.innerHTML='<a href="javascript:;">[\u751F\u6210\u6A21\u677F] </a>',p.classList.add("xg1"),p.addEventListener("click",()=>{const v=document.querySelector(".t_table");v?he(v):showPrompt(null,null,"<span>\u6A21\u677F\u751F\u6210\u5931\u8D25\uFF0C\u53EF\u5C1D\u8BD5\u4F7F\u7528\u9009\u533A\u529F\u80FD</span>",1500)}),g.appendChild(p);const f=document.createElement("span");f.innerHTML='<a href="javascript:;">[\u4F7F\u7528\u9009\u533A] </a>',f.classList.add("xg1"),f.addEventListener("click",v=>{v.stopPropagation(),showPrompt(null,null,"<span>\u9F20\u6807\u79FB\u52A8\u9009\u53D6\u9700\u8981\u7684\u533A\u57DF\uFF0C\u7136\u540E\u70B9\u51FB</span>",1e3),J.current=!0}),g.appendChild(f)}))},[]),c.useEffect(()=>{let g;return re(H(window,"mousemove",p=>{if(J.current){g=p.target;const f=g.getBoundingClientRect();q.current.style.setProperty("top",f.top+"px"),q.current.style.setProperty("left",f.left+"px"),q.current.style.setProperty("width",f.width+"px"),q.current.style.setProperty("height",f.height+"px")}}),H(window,"click",()=>{J.current&&(he(g),J.current=!1,q.current.style.setProperty("width","0"),q.current.style.setProperty("height","0"))}))},[]);function Te(g){if(!Le)return null;if(g==="table"){const p=d.current.getBoundingClientRect(),f=d.current.children[0],v=f.children;if(!v.length)return null;const T=d.current.style.backgroundColor.match(/(\d+)+/g),C=d.current.bgColor,A=T?{r:T[0],g:T[1],b:T[2]}:C;return I("div",{style:{top:P.current.top+Math.max(p.top,0),left:P.current.left+p.left,width:p.width,height:0},className:"hs-toolbar",children:[s("div",{draggable:!0,className:"col-all",onDragStart:h=>{h.dataTransfer.setData("text/plain","table")},onClick:()=>{M(-1)},onMouseLeave:()=>{M(null)},onMouseEnter:()=>{o(null)},children:Z===-1&&I("div",{className:"col-btn-group",children:[s("div",{title:"\u62F7\u8D1D",onClick:h=>{h.stopPropagation();const r=d.current;r.nextElementSibling?r.parentElement.insertBefore(r.cloneNode(!0),r.nextElementSibling):r.parentElement.appendChild(r.cloneNode(!0))},children:"\u21CA"}),s("div",{title:"\u5C45\u4E2D",onClick:h=>{h.stopPropagation();const r=d.current,m=document.createElement("div");m.align="center";const i=r.parentElement,u=r.nextElementSibling;m.appendChild(r),u?i.insertBefore(m,u):i.appendChild(m),e("")},children:"\u2261"}),s(_e,{defaultColor:A,onChange:h=>{const r=d.current;r.style.backgroundColor="",r.bgColor=h},children:s("div",{title:"\u8BBE\u7F6E\u989C\u8272",children:"#"})}),s("div",{title:"\u8BBE\u7F6E\u5BBD\u5EA6",className:"btn-resize",onClick:h=>{h.stopPropagation();const r=d.current,m=parseInt(prompt("\u8BF7\u8F93\u5165\u8868\u683C\u5BBD\u5EA6",r.width||"98")||r.width);if(m){const i=Math.max(Math.min(98,m),0);r.style.width="",r.width=i+"%"}},children:"\u0397"}),s("div",{title:"\u5220\u9664",className:"btn-delete",onClick:h=>{h.stopPropagation(),d.current.remove(),o(null),M(null)},children:"\u2573"})]})}),s("div",{className:"col",children:Array.from(v[0].children).map((h,r,m)=>s("span",{draggable:!0,onDragStart:i=>{i.dataTransfer.setData("text/plain",`col-${r}`)},onClick:()=>{M(r)},onMouseLeave:()=>{M(null)},onMouseMove:i=>{if(i.target.tagName==="SPAN"){const u=i.target.getBoundingClientRect();o(u),a(null);const E=i.nativeEvent.offsetX/u.width>.5?1:0;S(E),L(r+E)}},className:"col-item",style:{flex:`0 0 ${h.clientWidth+1}px`},children:r===Z&&I("div",{className:"col-btn-group",children:[r!==0&&s("div",{title:"\u79FB\u52A8\u5230\u5DE6\u4FA7\u5217",onClick:i=>{i.stopPropagation(),Array.from(v).forEach(u=>{const E=u.children;u.insertBefore(E.item(r),E.item(r-1))}),o(null),M(null),e("")},children:"\u21A4"}),r!==m.length-1&&s("div",{title:"\u79FB\u52A8\u5230\u53F3\u4FA7\u5217",onClick:i=>{i.stopPropagation(),Array.from(v).forEach(u=>{const E=u.children;u.insertBefore(E.item(r),E.item(r+2))}),o(null),M(null),e("")},children:"\u21A6"}),s("div",{title:"\u8BBE\u7F6E\u5217\u5BBD",className:"btn-resize",onClick:i=>{i.stopPropagation();const u=h,E=parseInt(prompt("\u8BF7\u8F93\u5165\u6B64\u5217\u5BBD\u5EA6",u.width||"98")||u.width);if(E){const z=Math.max(Math.min(98,E),0);u.width=z+"%"}e("")},children:"\u0397"}),s("div",{title:"\u5220\u9664",className:"btn-delete",onClick:i=>{i.stopPropagation(),Array.from(v).forEach(u=>u.children.item(Z).remove()),o(null),M(null),e("")},children:"\u2573"})]})},r))}),s("div",{style:{height:Math.min(P.current.height,p.height+Math.min(0,p.top))},className:"row",children:Array.from(v).map((h,r,m)=>{const i=h.getBoundingClientRect(),u=Math.max(0,i.top),E=Math.min(P.current.height,i.bottom),z=Math.max(0,E-u);return s("span",{draggable:!0,onDragStart:D=>{D.dataTransfer.setData("text/plain",`row-${r}`)},onClick:()=>{B(r)},onMouseLeave:()=>{B(-1)},onMouseMove:D=>{if(D.target.tagName==="SPAN"){const R=D.target.getBoundingClientRect();a(R),o(null);const U=D.nativeEvent.offsetY/R.height>.5?1:0;k(U),j(r+U)}},style:{flex:`0 0 ${z}px`},className:"row-item",children:W===r&&I("div",{className:"row-btn-group",children:[r!==0&&s("div",{title:"\u79FB\u52A8\u5230\u4E0A\u4E00\u884C",onClick:D=>{D.stopPropagation(),f.insertBefore(h,f.children.item(r-1)),a(null),B(-1),e("")},children:"\u21A5"}),r!==m.length-1&&s("div",{title:"\u79FB\u52A8\u5230\u4E0B\u4E00\u884C",onClick:D=>{D.stopPropagation(),f.insertBefore(h,f.children.item(r+2)),a(null),B(-1),e("")},children:"\u21A7"}),s("div",{title:"\u5220\u9664",className:"btn-delete",onClick:D=>{D.stopPropagation(),h.remove(),a(null),B(-1)},children:"\u2573"})]})},r)})}),n&&s("div",{onClick:()=>{const m=d.current.children[0].children;Array.from(m).forEach(i=>{const u=i.children,E=document.createElement("td");i.insertBefore(E,u.item(w))}),o(null)},style:{top:n.top,left:n.left+b*n.width,height:Math.min(p.height,P.current.height)+10},className:"col-cursor"}),l&&s("div",{onClick:()=>{const r=d.current.children[0],m=r.children;if(m.length===N){const i=m[0],u=document.createElement("tr");u.innerHTML="<td>&nbsp;</td>".repeat(i.children.length),r.append(u)}else{const i=m[N],u=document.createElement("tr");u.innerHTML="<td>&nbsp;</td>".repeat(i.children.length),r.insertBefore(u,i)}a(null)},style:{top:l.top+_*l.height,left:l.left,width:p.width+10},className:"row-cursor"})]})}return null}return I("div",{children:[s("div",{ref:q,style:{position:"fixed",zIndex:999,top:0,left:0,width:0,height:0,backgroundColor:"#00a6ff",opacity:.5,pointerEvents:"none"}}),Te(t)]})}function Me(){return s("div",{})}const Q=document.createElement("div");Q.classList.add("hs-bbcode-helper-root"),document.body.appendChild(Q),V.createRoot(Q).render(s(X.default.StrictMode,{children:s(Se,{})}));const me=document.getElementById("e_iframe");if(me){const t=me.contentWindow.document,e=t.head,n=t.createElement("style");n.innerText=`
    body {
        background-color: #fff;
    }
    table td {
        border: 1px solid #E3EDF5;
    }
    .t_table:not([width]) {
        width: 100%;
    }
    div.quote {
        background: #F9F9F9 url(https://www.mcbbs.net/template/mcbbs/image/icon_quote_s.gif) no-repeat 20px 6px;
    }
    div.quote blockquote:last-child {
        background: url(https://www.mcbbs.net/template/mcbbs/image/icon_quote_e.gif) no-repeat 100% 100%;
    }
    br[style] {
        display: none;
    }
    blockquote {
        display: inline-block;
    }
    tr.dragover {
        border: 8px dashed #ffae00;
    }
    `,e.appendChild(n);const o=t.createElement("div");o.classList.add("hs-bbcode-helper-eiframe-root"),t.body.appendChild(o),V.createRoot(o).render(s(X.default.StrictMode,{children:s(Me,{})}))}})(React,ReactDOM);
